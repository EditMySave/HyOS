---
description: Hytale Server API Plugin development guidelines
globs: hytale-api-plugin/**/*
alwaysApply: false
---

# Server API Plugin Rules

## Overview

Java REST/WebSocket plugin for Hytale dedicated server management.

## Build

See `.cursor/skills/build-api-plugin/SKILL.md` for build workflow.

## Patterns

- REST endpoints in `src/main/java/.../api/`
- DTOs for request/response serialization
- WebSocket handlers for real-time updates

## Config Null-Safety

Always implement deep-merge in `withDefaults()` methods:

```java
// ❌ BAD - only checks top-level null
cors != null ? cors : CorsConfig.defaults()

// ✅ GOOD - deep-merge nested configs
cors != null ? cors.withDefaults() : CorsConfig.defaults()
```

Nested fields can be null even when parent is not (e.g., `cors: {}` creates object with null fields).

## Authentication

- bcrypt for password hashing (cost factor 12)
- Config stores bcrypt hash, client sends plaintext
- JWT tokens for authenticated sessions

## Config Regeneration

Plugin config only loads at startup. If credentials change:

1. Update `manager-config.json`
2. Set `API_REGENERATE_CONFIG=true` or delete existing config
3. Restart container

## Output

Plugin JAR bundled with Docker server configurations.
